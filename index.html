<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unlock the Gift</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      background: #111;
      border: 2px solid #b78bfa;
      border-radius: 10px;
    }
    #gift {
      width: 130px;
      height: 130px;
      display: none;
      margin-top: 20px;
      cursor: pointer;
      animation: pulse 1.5s infinite;
    }
    .gift-emoji {
      font-size: 100px;
      display: none;
      margin-top: 20px;
      cursor: pointer;
      animation: pulse 1.5s infinite;
      text-align: center;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .cta { margin-top: 10px; color: #b78bfa; font-weight: 600; }
    /* Sheenify banner styles */
    .sheenify-banner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      padding: 10px 0;
      background: linear-gradient(90deg, rgba(183,139,250,1) 0%, rgba(255,255,255,0) 100%);
      text-align: center;
      z-index: 1000;
    }
    .sheenify-logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: #b78bfa;
      text-shadow: 0 0 10px rgba(183,139,250,0.8);
    }
  </style>
</head>
<body>
  

  <div>
    <canvas id="gameCanvas" width="700" height="500"></canvas>
    <div id="giftMessage" style="display:none; text-align:center; margin-top:30px; font-size:1.2rem; color:#b78bfa; font-weight:600;">
      Well done baby, now here's your gift ily.
    </div>
    <img id="gift" src="assets/gift.png" alt="Gift" onclick="openGift()" 
         style="display:none; width:130px; height:130px;"
         onerror="this.style.display='none'; document.getElementById('giftEmoji').style.display='block';">
    <div id="giftEmoji" class="gift-emoji" onclick="openGift()" style="display:none; font-size:100px; text-align:center; margin-top:20px;">üéÅ</div>
    <div id="cta" class="cta"></div>
  </div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  let player = { x: 50, y: 180, radius: 15, dx: 0, dy: 0, speed: 2 };
  let keys = {};
  let collected = 0;

  // üé® Specify image positions individually
  const itemImages = [
    { src: "assets/gameObjects/IMG_6421.jpg", x: 150, y: 120 },
    { src: "assets/gameObjects/IMG_6422.jpg", x: 330, y: 350 },
    { src: "assets/gameObjects/IMG_6423.jpg", x: 600, y: 200 }
  ];

  // preload images with custom positions
  let items = itemImages.map((item) => {
    const img = new Image();
    img.src = item.src;
    return {
      img: img,
      x: item.x,
      y: item.y,
      size: 40,
      collected: false
    };
  });

  // Add obstacles (rectangles)
  const obstacles = [
    { x: 200, y: 120, w: 40, h: 180 },
    { x: 400, y: 60, w: 30, h: 250 },
    { x: 550, y: 300, w: 80, h: 40 }
  ];

  // Add traps (red circles)
  const traps = [
    { x: 150, y: 250, r: 20 },
    { x: 600, y: 150, r: 25 },
    { x: 350, y: 450, r: 30 },
    { x: 100, y: 400, r: 40 }
  ];

  document.addEventListener("keydown", (e) => keys[e.key] = true);
  document.addEventListener("keyup", (e) => keys[e.key] = false);

  // Sparkle particles array
    let particles = [];

    function createSparkles(x, y) {
    for (let i = 0; i < 12; i++) {
        particles.push({
        x: x,
        y: y,
        dx: (Math.random() - 0.5) * 4,
        dy: (Math.random() - 0.5) * 4,
        life: 1, // opacity
        size: 3 + Math.random() * 3
        });
    }
    }

    function updateParticles() {
    particles.forEach(p => {
        p.x += p.dx;
        p.y += p.dy;
        p.life -= 0.02;
    });
    particles = particles.filter(p => p.life > 0);
    }

    function drawParticles() {
    particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(183,139,250,${p.life})`; // purple sparkle
        ctx.fill();
    });
    }
  function update() {
    // Movement logic (add this at the start of update)
    player.dx = 0;
    player.dy = 0;
    if (keys["ArrowLeft"] || keys["a"]) player.dx = -player.speed;
    if (keys["ArrowRight"] || keys["d"]) player.dx = player.speed;
    if (keys["ArrowUp"] || keys["w"]) player.dy = -player.speed;
    if (keys["ArrowDown"] || keys["s"]) player.dy = player.speed;

    let nextX = player.x + player.dx;
    let nextY = player.y + player.dy;

    // boundaries
    if (nextX - player.radius < 0) nextX = player.radius;
    if (nextX + player.radius > canvas.width) nextX = canvas.width - player.radius;
    if (nextY - player.radius < 0) nextY = player.radius;
    if (nextY + player.radius > canvas.height) nextY = canvas.height - player.radius;

    // obstacle collision (simple AABB)
    let blocked = false;
    obstacles.forEach(obs => {
      if (
        nextX + player.radius > obs.x &&
        nextX - player.radius < obs.x + obs.w &&
        nextY + player.radius > obs.y &&
        nextY - player.radius < obs.y + obs.h
      ) {
        blocked = true;
      }
    });

    if (!blocked) {
      player.x = nextX;
      player.y = nextY;
    }

    // trap collision
    traps.forEach(trap => {
      let dx = player.x - trap.x;
      let dy = player.y - trap.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < player.radius + trap.r) {
        // Reset player position
        player.x = 50;
        player.y = 180;
      }
    });

    // collisions with items
    items.forEach(item => {
      if (!item.collected) {
        let dx = player.x - (item.x + item.size/2);
        let dy = player.y - (item.y + item.size/2);
        let distance = Math.sqrt(dx*dx + dy*dy);
        if (distance < player.radius + item.size/2) {
          item.collected = true;
          collected++;
          createSparkles(item.x + item.size/2, item.y + item.size/2);
        }
      }
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // draw obstacles
    obstacles.forEach(obs => {
      ctx.fillStyle = "#444";
      ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
    });

    // draw traps
    traps.forEach(trap => {
      ctx.beginPath();
      ctx.arc(trap.x, trap.y, trap.r, 0, Math.PI * 2);
      ctx.fillStyle = "#e74c3c";
      ctx.fill();
      ctx.closePath();
    });

    // draw player
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
    ctx.fillStyle = "#b78bfa";
    ctx.fill();
    ctx.closePath();

    // draw items with sparkle/pulse
    const time = Date.now() / 300;
    items.forEach(item => {
      if (!item.collected) {
        const pulse = 1 + 0.1 * Math.sin(time + item.x);
        const size = item.size * pulse;
        const offset = (size - item.size) / 2;
        ctx.save();
        ctx.shadowColor = "#b78bfa";
        ctx.shadowBlur = 20;
        ctx.drawImage(item.img, item.x - offset, item.y - offset, size, size);
        ctx.restore();
      }
    });

    // progress text
    ctx.fillStyle = "#b78bfa";
    ctx.font = "16px Inter";
    ctx.fillText(`Captured: ${collected}/3`, 10, 20);
}


  function gameLoop() {
  update();
  updateParticles();
  draw();
  drawParticles();

  if (collected === items.length) {
    document.getElementById("giftMessage").style.display = "block";
    document.getElementById("gift").style.display = "block";
    document.getElementById("cta").textContent = "Click the gift to unlock üéÅ";
    // If image fails, show emoji
    if (document.getElementById("gift").style.display === "none") {
      document.getElementById("giftEmoji").style.display = "block";
    }
    return;
  } else {
    document.getElementById("giftMessage").style.display = "none";
    document.getElementById("gift").style.display = "none";
    document.getElementById("giftEmoji").style.display = "none";
    document.getElementById("cta").textContent = "";
  }

  requestAnimationFrame(gameLoop);
  }


  function openGift() {
    window.location.href = "playlist.html";
  }

  gameLoop();
</script>

</body>
</html>
